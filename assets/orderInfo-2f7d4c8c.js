import{h as g,o as u,c as p,e as t,i as _,w as h,u as a,a0 as U,F as y,b as L,v as A,z as B,y as q,A as E,t as r,k as G,H as m,T as K,P as W,Q as O,f as tt,g as et,r as st,D as S,m as ot,n as F,X as at,ad as M,Z as nt,ae as lt,ac as ct}from"./index-fd57ddf8.js";import{_ as it}from"./ShoppingFlowChart-afac59e3.js";import{e as N,w as j,s as P}from"./useNotification-d5b03d5c.js";const rt={class:"flex items-center justify-between"},dt=t("span",{class:"text-xl titleText"},"優惠券",-1),ut={class:"flex flex-wrap w-full mt-6 overflow-y-auto max-h-[250px]"},pt=["id","value"],_t=["for"],ft=t("p",{class:"text-sm text"},"單筆消費滿1000元即可使用一張",-1),mt=t("p",{class:"text-sm text"},"使用日期：2022/12/31",-1),ht={class:"flex items-center justify-center gap-4"},xt={__name:"DiscountModal",props:{discountList:{type:Array,default:()=>[]}},emits:["update-selected-discount"],setup(b,{emit:v}){const l=g([]),d=g(!1),e=async()=>{d.value=!d.value},x=()=>{d.value=!d.value,l.value.length===0&&(l.value[0]=0),v("update-selected-discount",l.value)};return(T,f)=>{const w=W,D=O;return u(),p(y,null,[t("span",{class:"underline cursor-pointer text",onClick:e},"使用優惠券"),_(K,{modelValue:a(d),"onUpdate:modelValue":f[1]||(f[1]=i=>B(d)?d.value=i:null)},{title:h(()=>[t("div",rt,[dt,_(a(U),{class:"w-5 h-5 cursor-pointer hover:text-[#CCC5B9] transition-colors duration-150",onClick:e})])]),content:h(()=>[t("div",ut,[b.discountList.length>0?(u(!0),p(y,{key:0},L(b.discountList,i=>(u(),p("div",{key:i.ID,class:"w-1/2 p-2"},[A(t("input",{id:i.ID,type:"checkbox",value:i.ID,class:"hidden","onUpdate:modelValue":f[0]||(f[0]=C=>B(l)?l.value=C:null)},null,8,pt),[[q,a(l)]]),t("label",{for:i.ID},[t("div",{class:E(["relative p-2 transition-colors duration-150 border-2 rounded cursor-pointer group",[a(l).includes(i.ID)?"bg-[#DDBEA9]":"bg-white hover:bg-[#DDBEA9]"]])},[t("h3",{class:E(["titleText text-center text-xl before:content-['NT$'] before:mr-1 mb-2",[a(l).includes(i.ID)?"text-white":"group-hover:text-white"]])},r(i.Amount),3),ft,mt],2)],8,_t)]))),128)):G("",!0)])]),footer:h(()=>[t("div",ht,[_(w,{class:"w-full",onClick:e},{default:h(()=>[m(" 取消 ")]),_:1}),_(D,{class:"w-full",onClick:x},{default:h(()=>[m(" 確定 ")]),_:1})])]),_:1},8,["modelValue"])],64)}}},gt={class:"mb-10"},yt={class:"relative h-[calc(100vh-5rem)] mt-5 border border-[#DDBEA9]"},bt={class:"absolute top-0 bottom-0 w-full space-y-6 overflow-y-auto"},vt={class:"w-full"},wt={class:"border-b border-[#DDBEA9]"},Dt=t("th",{class:"px-5 py-3 text-sm font-medium tracking-wider text-left text-[#CB997E] bg-[#FFE8D6] whitespace-nowrap"},null,-1),Ct={class:"px-5 py-3 whitespace-nowrap text"},It={class:"flex w-full gap-2"},kt=["src"],St={class:"flex items-center justify-between w-full"},Ft={class:"flex flex-col items-start text"},Nt={class:"truncate w-[150px] text-left"},Lt={class:"text-xs truncate w-[150px] text-left"},At={class:"text-xs before:content-['NT$'] before:mr-1"},Tt={class:"px-5 py-3 text"},Vt={class:"flex items-center"},$t=["onClick"],Bt=["value"],Et=["onClick"],Mt={class:"px-5 py-3 text"},jt={class:"px-5 py-3 whitespace-nowrap text-text-secondary"},Pt={key:0},Ut=t("td",{colspan:"4",class:"py-12 text-center text"},"您的購物車是空的",-1),Gt=[Ut],Ot={class:"flex flex-col w-full gap-5 mt-5 sm:flex-row"},Rt={class:"w-full border border-[#DDBEA9] pb-9"},zt=t("h3",{class:"text-xl titleText bg-[#FFE8D6] px-2 py-1"},"送貨以及付款方式",-1),Xt={class:"px-4 py-1 sent_options"},Ht=t("p",{class:"text"},"送貨方式",-1),Jt=t("option",{value:"null",disabled:"",selected:""},"請選擇送貨方式",-1),Qt=t("option",{value:"自取"},"自取",-1),Yt=t("option",{value:"冷藏包裹"},"冷藏包裹",-1),Zt=[Jt,Qt,Yt],qt={class:"px-4 py-1 sent_options"},Kt=t("p",{class:"text"},"付款方式",-1),Wt=t("option",{value:"null",disabled:"",selected:""},"請選擇付款方式",-1),te=t("option",{value:"現金"},"現金",-1),ee=t("option",{value:"信用卡"},"信用卡",-1),se=t("option",{value:"匯款"},"匯款",-1),oe=[Wt,te,ee,se],ae={class:"w-full sm:w-2/5 border border-[#DDBEA9] pb-9"},ne=t("h3",{class:"text-xl titleText bg-[#FFE8D6] px-2 py-1"},"訂單資訊",-1),le={class:"flex flex-col gap-2 px-4 py-1"},ce={class:"flex items-center justify-between text"},ie={class:"flex items-center justify-between text"},re={class:"flex items-center justify-between text"},de={class:"text-right text border-b border-[#DDBEA9] pb-2"},ue={class:"flex items-center justify-between mt-3 text"},pe={class:"flex items-center justify-end w-full mt-5"},he={__name:"orderInfo",setup(b){const v=tt(),l=et(),d=g([{key:"ID",label:"商品詳情"},{key:"CheckoutAt",label:"數量"},{key:"OrderStage",label:"小計"}]),e=st({goodsList:[],goodsSpecs:[],discountID:null,updateCartForm:{ID:0,GoodsID:0,Specs:[{ID:0,SpecID:0,Num:0}]},deliveryValue:null,paymentValue:null,deliveryFee:0,discountFee:0,total:0}),x=async()=>{await l.dispatch("cartModules/updateCartItems"),e.goodsList=l.getters["cartModules/goodsList"],X(),Q()},T=S(()=>{let s=0;for(const o in e.goodsList)s+=e.goodsList[o].total;return s}),f=S(()=>{let s=0;for(const o in e.goodsList)s+=e.goodsList[o].total;return s+e.deliveryFee-e.discountFee}),w=()=>{e.deliveryValue==="自取"?e.deliveryFee=0:e.deliveryFee=150},D=async s=>{const o={ID:s};try{await F(ct,o,async c=>{P("購物車商品刪除成功"),await x(),await l.dispatch("cartModules/updateCartItems")})}catch(c){N("購物車商品刪除失敗",c)}},i=s=>{nt("確定要刪除商品?").then(o=>{o&&D(s)})},C=s=>{e.discountID=s[0];const o=I.value.find(c=>c.ID===s[0]);o&&(e.discountFee=o.Amount)},R=()=>{if(!e.deliveryValue){j("請選擇送貨方式");return}if(!e.paymentValue){j("請選擇付款方式");return}l.commit("cartModules/UPDATE_CART_PAYMENT",e),l.commit("cartModules/UPDATE_CART_TOTAL",f.value),v.push("/cart/fillInfo")};ot(async()=>{await x(),await Y()});const V=async(s,o)=>{e.updateCartForm.ID=o.ID,e.updateCartForm.GoodsID=o.GoodsID,e.updateCartForm.Specs[0].ID=o.Specs[0].ID,e.updateCartForm.Specs[0].SpecID=o.Specs[0].SpecID,s==="plus"&&o.Specs[0].Num<99?e.updateCartForm.Specs[0].Num=o.Specs[0].Num+1:s==="minus"&&o.Specs[0].Num>1&&(e.updateCartForm.Specs[0].Num=o.Specs[0].Num-1);const c=e.updateCartForm;try{await F(lt,c,async()=>{P("購物車商品更新成功"),await x(),await l.dispatch("cartModules/updateCartItems")})}catch(k){N("購物車商品更新失敗",k)}},z=S(()=>e.deliveryFee*1),X=()=>{const o=JSON.parse(localStorage.getItem("goodsInfo")).map(c=>c.GoodsSpecs);e.goodsSpecs=o.flat(1/0)},H=s=>{for(const o in e.goodsSpecs)s.Specs[0].SpecID===e.goodsSpecs[o].ID&&(s.specsName=e.goodsSpecs[o].Specs)},J=s=>{for(const o in s.Specs)for(const c in e.goodsSpecs)s.Specs[o].SpecID===e.goodsSpecs[c].ID&&s.specsName.push(e.goodsSpecs[c].Specs);s.specsName.splice(0,1),s.specsName=s.specsName.join()},Q=()=>{for(const s in e.goodsList)e.goodsList[s].Specs.length>1?(e.goodsList[s].specsName=[],J(e.goodsList[s])):e.goodsList[s].Specs.length===1&&H(e.goodsList[s])},I=g([]),Y=async()=>{const s="";try{await F(at,s,o=>{I.value=[...o.Data.DiscountTicket]})}catch(o){N("優惠卷取得失敗",o)}};return(s,o)=>{const c=it,k=xt,Z=O;return u(),p("main",gt,[_(c),t("div",yt,[t("div",bt,[t("table",vt,[t("thead",null,[t("tr",wt,[(u(!0),p(y,null,L(a(d),n=>(u(),p("th",{key:n.key,class:"px-5 py-3 text-sm font-medium tracking-wider text-left text-[#CB997E] bg-[#FFE8D6] whitespace-nowrap"},r(n.label),1))),128)),Dt])]),t("tbody",null,[(u(!0),p(y,null,L(a(e).goodsList,n=>(u(),p("tr",{key:n.id},[t("td",Ct,[t("div",It,[t("img",{src:n.ImageUrls,alt:"",class:"w-12"},null,8,kt),t("div",St,[t("div",Ft,[t("p",Nt,r(n.Goods.Name),1),t("p",Lt,r(n.specsName),1),t("span",At,r(n.TimestampPice),1)])])])]),t("td",Tt,[t("div",Vt,[t("button",{onClick:$=>V("minus",n),class:"px-2 py-1 border border-gray-300 rounded-l-md"}," - ",8,$t),t("input",{type:"text",readonly:"",value:n.Specs[0].Num,class:"w-12 py-1 text-center border-t border-b border-gray-300 focus:ring-0 focus:outline-none"},null,8,Bt),t("button",{onClick:$=>V("plus",n),class:"px-2 py-1 border border-gray-300 rounded-r-md"}," + ",8,Et)])]),t("td",Mt,r(n.total),1),t("td",jt,[_(a(U),{class:"w-5 h-5 cursor-pointer hover:text-[#CCC5B9] transition-colors duration-150",onClick:$=>i(n.ID)},null,8,["onClick"])])]))),128)),a(e).goodsList.length?G("",!0):(u(),p("tr",Pt,Gt))])])])]),t("div",Ot,[t("div",Rt,[zt,t("div",Xt,[Ht,A(t("select",{"onUpdate:modelValue":o[0]||(o[0]=n=>a(e).deliveryValue=n),class:"mt-1 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",onChange:w},Zt,544),[[M,a(e).deliveryValue]])]),t("div",qt,[Kt,A(t("select",{"onUpdate:modelValue":o[1]||(o[1]=n=>a(e).paymentValue=n),class:"mt-1 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"},oe,512),[[M,a(e).paymentValue]])])]),t("div",ae,[ne,t("div",le,[t("div",ce,[m(" 商品總計： "),t("span",null,r(a(T)),1)]),t("div",ie,[m(" 運費 "),t("span",null,r(a(z)),1)]),t("div",re,[m(" 優惠券 "),t("span",null,r(a(e).discountFee>0?`-${a(e).discountFee}`:""),1)]),t("div",de,[_(k,{discountList:a(I),onUpdateSelectedDiscount:C},null,8,["discountList"])]),t("div",ue,[m(" 合計： "),t("span",null,r(a(f)),1)])])])]),t("div",pe,[_(Z,{class:"w-full sm:w-1/5",onClick:R},{default:h(()=>[m("前往結帳")]),_:1})])])}}};export{he as default};
