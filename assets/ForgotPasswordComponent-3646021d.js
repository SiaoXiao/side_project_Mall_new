import{r as k,af as P,s as d,o as i,c as l,e as s,u as a,i as c,v as m,x as u,t as f,j as E,B as w,n as p,aj as M,ak as D}from"./index-fd57ddf8.js";import{I as S}from"./envelope-e7c862eb.js";import{v as b,a as v,I as V}from"./login-058d1677.js";import{e as g,s as F}from"./useNotification-d5b03d5c.js";import"./index-8a070b16.js";import"./user-20-solid-7819ed41.js";import"./trash-035f5d7d.js";import"./useUser-77d418ae.js";const B=s("legend",{class:"mb-3 text-center titleText"},"忘記密碼",-1),C={key:0,class:"flex flex-col mb-3 tracking-wider"},N={class:"relative flex items-center gap-2 py-2 before:absolute before:content before:w-full before:bottom-0 before:left-0 before:h-[2px] before:bg-[#323232]"},I=s("label",{for:"forgotEmail",class:"whitespace-nowrap"},"Email",-1),j={class:"w-full h-6 px-3 pt-1"},A={"data-test":"errorMsg",class:"text-sm tracking-wide text-[#dc2626]"},T={key:1,class:"flex flex-col mb-3 tracking-wider"},U={class:"relative flex items-center gap-2 py-2 before:absolute before:content before:w-full before:bottom-0 before:left-0 before:h-[2px] before:bg-[#323232]"},L=s("label",{for:"password",class:"whitespace-nowrap"},"新密碼",-1),W={class:"w-full h-6 px-3 pt-1"},q={"data-test":"errorMsg",class:"text-sm tracking-wide text-[#dc2626]"},z={key:2,class:"submit_box"},G=["disabled"],H={key:3,class:"submit_box"},J=["disabled"],se={__name:"ForgotPasswordComponent",setup(K){const e=k({email:{value:"",errorMessage:""},newPassword:{value:"",errorMessage:""},key:"",submitted:!1,isSubmit:!1}),h=()=>b(e.email.value)?!0:(e.email.errorMessage="請輸入有效的email格式",!1),_=async()=>{e.submitted=!0,await w(1e3),h()?n():e.isSubmit=!1},n=async()=>{const o={Email:e.email.value};try{await p(M,o,t=>{e.key=t.Data.Verify})}catch(t){g("失敗",t)}finally{e.isSubmit=!1}},x=P("reload"),y=async()=>{e.submitted=!0,await w(1e3),v(e.newPassword.value)&&n();const o={Verify:e.key,NewPassword:e.newPassword.value};try{await p(D,o,()=>{F("密碼更新成功"),e.email.value="",e.newPassword.value="",e.key="",x()})}catch(t){g("密碼更新失敗",t)}finally{e.isSubmit=!1}};return d(()=>e.email.value,o=>{b(o)?e.email.errorMessage="":e.email.errorMessage="請輸入有效的email格式"}),d(()=>e.newPassword.value,o=>{v(o)?e.newPassword.errorMessage="":e.newPassword.errorMessage="密碼不能為空白"}),(o,t)=>(i(),l("form",{"data-test":"form",class:"px-6 py-3",onSubmit:t[2]||(t[2]=E((...r)=>o.submit&&o.submit(...r),["prevent"])),autocomplete:"on"},[s("fieldset",null,[B,a(e).key?(i(),l("div",T,[s("div",U,[c(a(V),{class:"w-9 h-9"}),L,m(s("input",{type:"text",name:"password",id:"password",class:"w-full bg-transparent border-none text-base tracking-wide text-[#323232] focus:ring-0 focus:outline-none","onUpdate:modelValue":t[1]||(t[1]=r=>a(e).newPassword.value=r)},null,512),[[u,a(e).newPassword.value]])]),s("div",W,[s("p",q,f(a(e).newPassword.errorMessage),1)])])):(i(),l("div",C,[s("div",N,[c(a(S),{class:"w-9 h-9"}),I,m(s("input",{"data-test":"email",type:"email",name:"email",id:"forgotEmail",class:"w-full bg-transparent border-none text-base tracking-wide text-[#323232] focus:ring-0 focus:outline-none","onUpdate:modelValue":t[0]||(t[0]=r=>a(e).email.value=r)},null,512),[[u,a(e).email.value]])]),s("div",j,[s("p",A,f(a(e).email.errorMessage),1)])])),a(e).key?(i(),l("div",H,[s("input",{type:"submit",value:"更新密碼",onClick:y,class:"w-full p-3 rounded-md shadow-md bg-[#FFE8D6] hover:bg-[#DDBEA9] transition-colors duration-150 text-[#252422] hover:text-white",disabled:a(e).isSubmit},null,8,J)])):(i(),l("div",z,[s("input",{type:"submit",value:"送出",onClick:_,class:"w-full p-3 rounded-md shadow-md bg-[#FFE8D6] hover:bg-[#DDBEA9] transition-colors duration-150 text-[#252422] hover:text-white",disabled:a(e).isSubmit},null,8,G)]))])],32))}};export{se as default};
